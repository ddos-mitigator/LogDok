# LogDok

## Что

Сервис для отображения статуса контейнеров на *хосте* и получения их логов

## Как

На главной (статичной, с ajax включением контента) странице отображается
статус всех контейнеров: аналог `docker ps --all`

Статус контейнеров -- ссылка на страницу `/log`, принимающую
два аргумента:
`name` -- имя контейнера; и `tail` -- число последних строк
лога (возможно значение `all`)

Лог отдается (по дефолту 15 строк) как `plain/text`, т.е. можно удобно
запрашивать через `curl`

Поддерживаются два параметра окружения:

* `SP_AUTH_KEY` -- если задан, для получения лога необходимо передать
Header `X-Auth-Token` == *SP_AUTH_KEY*, иначе ответом будет `HTTP 403`

* `SP_DEFAULT_TAIL` -- если задан, задает дефолтное значение отдаваемых
строк лога (может быть целым числом или `all`), дефолтное значение `15`

## Разворачивание

### Docker run

* Внутри контейнера контент раздается на 80 порту, к нему нужно пробросить порт с хоста

* Сервис получает информацию по контейнерам через сокет докера, который нужно смонтировать

* Возможно передать дополнительные параметры `uwsgi`, как параметры
к entrypoint

```shellsession
docker run --rm [-it/-d] -p [3031:]80 \
    -v /var/run/docker.sock:/var/run/docker.sock \
    logdok [--socket /var/run/uwsgi/main.sock]
```

### Docker-compose

Возможно использование в размках docker-compose с проксированием через ищеющийся
веб-сервер(например, nginx): должны быть в одной сети и необходимо правильно
настроить конфигурацию nginx

```yaml
services:
  logdok:
    volumes:
    - /var/run/docker.sock:/var/run/docker.sock
    ports:
    - "3031:80"
```

Пример location для nginx:

```nginx
location ~* ^/logdok(.*) {
  proxy_pass http://logdok.localhost$1$is_args$args;
}
```
